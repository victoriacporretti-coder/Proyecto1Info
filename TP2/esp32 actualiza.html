<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Tablero de Control ESP32</title>
  <style>
    body {
      background-color: #003366; /* azul oscuro */
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      padding: 0;
    }

    h1 {
      background: #001a33;
      padding: 15px;
      margin: 0;
    }

    .panel {
      margin: 20px auto;
      padding: 20px;
      border: 5px solid white;
      border-radius: 15px;
      max-width: 600px;
      background: #004080;
      box-shadow: 0 0 20px rgba(0,0,0,0.6);
      position: relative;
    }

    .decoracion {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: inline-block;
      margin: 5px;
    }
    .rojo { background: red; }
    .verde { background: lime; }
    .blanco { background: white; }

    .fila-deco {
      position: absolute;
      top: 10px;
      right: 10px;
    }

    img {
      margin: 10px;
    }

    .alerta {
      margin-top: 15px;
    }

    #ultimaAct {
      margin-top: 15px;
      font-size: 14px;
      font-style: italic;
      color: #ddd;
    }
  </style>
</head>
<body>
  <h1>Tablero de Control ESP32-UTN</h1>

  <div class="panel">
    <div class="fila-deco">
      <span class="decoracion rojo"></span>
      <span class="decoracion blanco"></span>
      <span class="decoracion verde"></span>
    </div>

    <h2>Luz</h2>
    <img id="imgLuz" src="luz_apagada.png" alt="Luz" width="100">

    <h2>Temperatura</h2>
    <p><span id="valorTemp">--</span> °C</p>
    <img id="imgTemp" src="termo.png" alt="Termómetro" width="120">
    <div class="alerta">
      <img id="imgAlerta" src="barra de humedad.png" alt="" width="100" style="display:none;">
    </div>

    <h2>Humedad</h2>
    <p><span id="valorHum">--</span> %</p>
    <img id="imgHum" src="barra humedad.png" alt="Humedad" width="200">

    <h2>Movimiento</h2>
    <p><span id="valorMov">--</span></p>

    <h2>Puerta</h2>
    <p><span id="valorPuerta">--</span></p>

    <p id="ultimaAct">Esperando primera actualización...</p>
  </div>

  <script>
    async function obtenerDatos() {
      try {
        const respuesta = await fetch("http://192.168.1.50/"); // IP de tu ESP32
        const datos = await respuesta.json();

        // Temperatura
        document.getElementById("valorTemp").innerText = datos.temperatura;
        let tempImg = "termo_temp" + (Math.round(datos.temperatura/10)*10) + ".png";
        document.getElementById("imgTemp").src = tempImg;

        // Alerta
        if (datos.temperatura > 35) {
          document.getElementById("imgAlerta").style.display = "inline";
          document.getElementById("imgAlerta").src = "alerta_temp.png";
        } else {
          document.getElementById("imgAlerta").style.display = "none";
        }

        // Humedad
        document.getElementById("valorHum").innerText = datos.humedad;
        let humImg = "barra_humedad_" + datos.humedad + ".png";
        document.getElementById("imgHum").src = humImg;

        // Luz
        if (datos.luzEncendida) {
          document.getElementById("imgLuz").src = "luz_encendida.png";
        } else {
          document.getElementById("imgLuz").src = "luz_apagada.png";
        }

        // Movimiento
        document.getElementById("valorMov").innerText = datos.movimiento ? "Detectado" : "No detectado";

        // Puerta
        document.getElementById("valorPuerta").innerText = datos.puertaAbierta ? "Abierta" : "Cerrada";

        // Actualización
        let ahora = new Date();
        document.getElementById("ultimaAct").innerText = 
          "Última actualización: " + ahora.toLocaleTimeString();

      } catch (e) {
        console.error("Error al obtener datos:", e);
      }
    }

    setInterval(obtenerDatos, 5000);
    obtenerDatos();
  </script>
</body>
</html>
